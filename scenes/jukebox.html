<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Aclonica&display=swap"
      rel="stylesheet"
      defer
    />
    <script type="text/javascript" src="../libraries/p5.min.js"></script>
    <script type="text/javascript" src="../libraries/p5.play.js"></script>
    <script type="text/javascript" src="../libraries/p5.sound.min.js"></script>
    <style>
      html,
      body {
        overflow: hidden;
        margin: 0;
        padding: 0;
      }

      button {
        background: #eda772;
        border: none;
        border-radius: 30px;
        width: 30px;
        height: 30px;
      }

      button:hover {
        background: rgb(173, 255, 255);
      }

      button:focus {
        background: rgb(53, 102, 102);
        outline: 2px solid white;
      }

      button:active {
        background: rgb(53, 102, 102);
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      // Canvas variables
      const canvas_height = 550;
      const canvas_width = 800;

      // Song variables
      const song_info = [
       {
          name: "Poetic Invitation",
          artist: "Sierra Downey ",
          path: "invitation.m4a",
        },
        // {
        //   name: "Let's Twist Again",
        //   artist: "Effie Ralli",
        //   path: "lets-twist-again.m4a",
        // },
      ];
      let song_array = []; // for p5 sound objects
      let current_song, song_index = 0;

      // radio and control variables
      let radio;
      let play_pause, jump_button;
      let amp;
      let positionX = canvas_width; // for marquee

      function preload() {
        // load songs into p5 sound object array
        for (let i = 0; i < song_info.length; i++) {
          song_array.push(
            loadSound("../assets/audio/music/" + song_info[i].path)
          );
        }

        radio = loadImage("../assets/img/radio.png");
        note_gold = loadImage("../assets/img/music-note-gold.png");
        note_blue = loadImage("../assets/img/8R_musical-note-blue.png");
        note_pink = loadImage("../assets/img/8R_musical-note-pink.png");
      }

      function setup() {
        createCanvas(canvas_width, canvas_height);

        /*
          CONTROLS
        */

        // play/pause button
        play_pause = createButton("▶️");
        play_pause.position(510, 346);
        play_pause.mousePressed(togglePlay);

        // next button
        skip = createButton("⏭️");
        // skip.position(460, 350);
        skip.mousePressed(toggleSkip);

        // amplitude visual
        amp = new p5.Amplitude();
      }

      function draw() {
        // radio
        image(radio, 155, 100, 500, 350);

        // fun amplitude viz
        let level = amp.getLevel();
        let size = map(level, 0, 1, 100, 200);
        image(note_gold, 60, height/2, size/4, size/4);
        image(note_gold, width-110, height/1.5, size/1.5, size/2);
        image(note_blue, 40, height-120, size/2, size/2);
        image(note_blue, width-100, height/4, size/3, size/2);
        image(note_pink, 60, 70, size/2.5, size/2);
        image(note_pink, width-200, height-100, size/2.23, size/3);

        // display song title
        current_song = song_array[song_index];
      }

      function togglePlay() {
        if (!current_song.isPlaying()) {
          current_song.play();
          play_pause.html("⏸️");
          amp = new p5.Amplitude();
          amp.setInput(sound);
        } else {
          current_song.pause();
          play_pause.html("▶️");
        }
      }

      function toggleSkip() {
        if (current_song.isPlaying) {
          current_song.stop();
          play_pause.html("▶️");

          if (song_index < song_array.length - 1) {
            song_index++;
          } else if (song_index == song_array.length - 1) {
            song_index = 0;
          }
        }
      }

    </script>
  </body>
</html>
