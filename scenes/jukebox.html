<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="../libraries/p5.min.js"></script>
    <script type="text/javascript" src="../libraries/p5.play.js"></script>
    <script type="text/javascript" src="../libraries/p5.sound.min.js"></script>
    <style>
      html,
      body {
        overflow: hidden;
        margin: 0;
        padding: 0;
        background: white;
      }

      button {
        font-family: Georgia, "Times New Roman", Times, serif;
        background-color: aliceblue;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      /****
        SCENE 3: song selector for jukebox
      ****/

      // Canvas variables
      const canvas_height = 320;
      const canvas_width = 400;

      // Song variables
      const song_info = [
        {
          name: "Just Like a Rainbow",
          artist: "The Columbians",
          path: "the_columbians_-_just_like_a_rainbow.mp3",
        },
        {
          name: "Who Let the Dogs Out",
          artist: "Baha Mxn",
          path: "who-let-the-dogs-out.m4a",
        },
        {
          name: "Gorl Crush",
          artist: "Harry Styles",
          path: "girl-crush.m4a",
        },
        {
          name: "Baby Won't You Please Come Home",
          artist: "Eva Taylor",
          path: "eva_taylor_-_baby_won't_you_please_come_home.mp3",
        },
      ];
      let song_array = []; // for p5 sound objects
      let current_song,
        song_index = 0;

      // Jukebox and control variables
      let play_pause, slider, jump_button;
      let amp;
      let positionX = canvas_width; // for marquee

      function preload() {
        // load songs into p5 sound object array
        for (let i = 0; i < song_info.length; i++) {
          song_array.push(
            loadSound("../assets/audio/music/" + song_info[i].path)
          );
        }

        note = loadImage("../assets/img/musical-note.png");
      }

      function setup() {
        createCanvas(canvas_width, canvas_height);
        // background(51);

        /*
          CONTROLS
        */

        // play/pause button
        play_pause = createButton("▶️");
        play_pause.position(width / 2.7, height / 2);
        play_pause.mousePressed(togglePlay);

        // next button
        skip = createButton("⏭️");
        skip.position(width / 1.9, height / 2);
        skip.mousePressed(toggleSkip);

        // volume slider
        slider = createSlider(0, 1, 0.5, 0.01);

        // amplitude visual
        amp = new p5.Amplitude();
      }

      function draw() {
        background(255);

        // jukebox
        // shadow
        fill(48, 37, 11);
        stroke(184, 154, 64);
        strokeWeight(5);
        rect(width / 4 + 20, height / 4 - 10, 200, 300, 100, 100, 0, 0);
        // actual body
        fill(82, 63, 18);
        stroke(252, 186, 3);
        strokeWeight(5);
        rect(width / 4, height / 4, 200, 300, 100, 100, 0, 0);
        // gold bars
        fill(252, 186, 3);
        noStroke();
        rect(width / 2.7, height / 1.5 + 20, 7, 70);
        rect(width / 2.1, height / 1.5 + 20, 7, 70);
        rect(width / 1.7, height / 1.5 + 20, 7, 70);

        // fun amplitude viz
        let level = amp.getLevel();
        let size = map(level, 0, 1, 100, 400);
        fill(235);
        image(note, width / 3, height / 2.8, size, size);

        // display song title
        current_song = song_array[song_index];
        displayCurrent();

        // volume control
        fill(0);
        textSize(14);
        text("🔈: ", 0, height);
        current_song.setVolume(slider.value());
      }

      function togglePlay() {
        if (!current_song.isPlaying()) {
          current_song.play();
          play_pause.html("⏸️");
        } else {
          current_song.pause();
          play_pause.html("▶️");
        }
      }

      function toggleSkip() {
        if (current_song.isPlaying) {
          current_song.stop();
          play_pause.html("▶️");

          if (song_index < song_array.length - 1) {
            song_index++;
          } else if (song_index == song_array.length - 1) {
            song_index = 0;
          }
        }
      }

      function displayCurrent() {
        textFont("Georgia", 24);
        fill(0);

        if (positionX < -250) {
          positionX = width;
        }

        text(
          "now playing: " +
            song_info[song_index].name +
            " - " +
            song_info[song_index].artist,
          positionX--,
          40
        );
      }
    </script>
  </body>
</html>
